<!--?php

if (session_status () == PHP_SESSION_NONE) {
    SESSION_SESSION();
}

if(!isset($_SESSION['loggedin']) | $_SESSION['loggedin'] != 'true') {
    header("Location: index.php");
};


?>*/-->
<!DOCTYPE html>
<html>
    
     <link href="css/grid.css" rel="stylesheet"/>
     <link href="css/bootstrap.css" rel="stylesheet"/>
 
    <style>
    

      body {
        font-family: 'Hind', sans-serif !important;
      }
        
      td {
        
        padding: 10px !important;
        border: solid 2px #DAE3E6;
      }
        
      tr {
        text-align:center; !important;
        border: solid 3px #DAE3E6;
      }
        
      th {
        clear:both;
        text-align:center !important;
        padding-top: 10px !important;
      }
    
      thead {
         background-color:rgba(81,68,57,0.6)!important;
         border-bottom: solid 2px #fff!important;
         color:#fff;
      }
        
      .loginpage {
         background-color:rgba(5,5,0,0.5);
         text-align: center;
         color: $almost-white;
         font-family: 'Raleway', sans-serif;
         text-shadow: 2px 2px 0 $dark-green;       
      }
        
    </style>
    
    
    
<body onload="popup('popUpDiv')">

        
 <!-------------------this is the sign up/ login page, appear before user login the admin page----------------------------->  
        
    
        

<div id="popUpDiv" >

    
    </br></br></br>
    <p style="text-align:left; margin-left:10%;">ZI,</p>
    <p class="center3">Welcome back to the Admin page!</p>
    <p class="center3">This page helps you to manage your stock.</p> 
    </br></br>
    
    <a id="dele" style="color:yellow;">Click to Close</a>
    
    
</div>
              
        
        
        
        
        
 <!--------------------this is the breaking point for the admin page---------------------------->        
<div class="adminPage">
     <div class="wrapper">


    <div class=" col-md-11">
           
                 <nav class="navbar navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#" ><img src="http://cdn02.thesak.com/resources/elliottlucca/images/layout/logo.png" width="165px" height="46px" /></a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <!--a href="#">About</a>
                    </li>
                    <li>
                        <a href="#">Services</a-->
                    </li>
                    
                </ul>
                <ul class="nav navbar-nav navbar-right" >
                    <li>
                        <a id="logoutbutton" class="btn-brown">Log out</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
   
               
    </div>


         <div class="holder"></div>
        


         <div id="content" >
            <div id="leftcontainer">
                <form id="addNewUser" >
                    <input id="addFirstName" type="text" placeholder="Product Name" required="required"/></br>
                    <input id="addLastName" type="text" placeholder="Price" required="required"/></br>
                    <input id="addUserName" type="text" placeholder="Description" required="required"/></br>
                    <input id="addquantity" type="text" placeholder="quantity" required="required"/></br>
                    <input id="image" type="text" placeholder="Image Path" required="required"></br>
    
                    <input id="submitNewUser" type="submit" value="Add"/>
          </form>  
        </div>
    
        <div id="rightcontainer">  
            <table id="users">
                <thead>
                  <tr>
                   
                    <th class="first_name_header"><span>PRODUCT</span></th>
                    <th class="last_name_header"><span>PRICE</span></th>
                    <th class="login_header"><span>DESCRIPTION</span></th>
                    <th class="image"><span>IMAGE</span></th>
                    <th class="quantity_header"><span>QUANTITY</span></th>  
                    <th class="delete_header"><span>DELETE</span></th>
                    <th class="delete_header"><span>UPDATE</span></th>
                   
                      
                  </tr>
                </thead>

                <tbody id='userrows'>
                  <!-- THIS SECTION WILL BE REPLACED BY SERVER GENERATED ROWS -->
                  <tr>
                    <td class="first_name"><span>aaa</span></td>
                    <td class="last_name"><span>bbb</span></td>
                    <td class="user_name"><span>uniqueloginname</span></td>
                    <td class="i_image"><span><img src=''/></span></td>
                    <td><input id="uniqueloginname" class="delete" type="button" value="Delete"/></td>
                  </tr>
                  <!-- THIS SECTION WILL BE REPLACED BY SERVER GENERATED ROWS -->
                </tbody>
              </table><br/>
            </div>
        </div>
            
            <div class="beforecenter">

            </div>

     </div>

    <div class="footer" >
        <div class="container1">
            <p class="pull-right"><a href="#">Back to top</a></p>
            <p class="text-muted">2015 Company, Inc.  <a href="#"> Privacy </a> <a href="#">Terms</a></p>
        </div>
     </div> 
</div>
</body>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>

        $(document).ready(function() {
            var pop = document.getElementById("popUpDiv");
            var dele = document.getElementById("dele");
            dele.onclick = function(){
                pop.style.display = "none";
                pop.style.visibility = "hidden";
            }
            
             $("#logoutbutton").bind("click", doLogout);
             
            function doLogout() {
                var formData = {logout: "true"};
                //console.log("Logout data to send: ", formData);

                $.ajax({
                    url: "./logout.php",
                    type: "POST",
                    dataType: "JSON",
                    data: formData,
                    success: function(returnedData) {
                        //console.log("Logout data returned: ", returnedData);
                        window.location.href = "signin.php";

                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        //console.log(jqXHR.statusText, textStatus, errorThrown);
                        console.log(jqXHR.statusText, textStatus);
                    }
                });
            }


            // logout event
            $("#logoutbutton").click(doLogout);

            
            function loadUsers() {
                $.ajax({
                    url: "./users.php",
                    type: "GET",
                    dataType: 'html',
                    success: function(returnedData) {
                        //console.log("cart checkout response: ", returnedData);
                        $("#userrows").html(returnedData);
                        //window.location.href = "user-editor.html";
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR.statusText, textStatus);
                    }
                });
            }

            loadUsers();


            $("#addNewUser").submit(function(e) {
                e.preventDefault();

                // get values from form
                var firstName = $("#addFirstName").val();
                var lastName = $("#addLastName").val();
                var userName = $("#addUserName").val();
                var image = $("#image").val();
                var quantity = $("#addquantity").val();
                console.log(firstName, lastName, userName, image, quantity);

                $.ajax({
                    url: "users.php",
                    type: "POST",
                    dataType: "JSON",
                    data: {action: "add", newFirstName: firstName,
                        newLastName: lastName, newUserName: userName,newImage:image, newQuantity:quantity},
                    success: function(returnedData) {
                        loadUsers();
                        console.log(returnedData);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $("#p1").text(jqXHR.statusText);
                    }

                });

            });

            $('#users').on('click', '.delete', function() {
                var loginValue = this.getAttribute("id");
                loginValue = loginValue.replace("d-", "");

                $.ajax({
                    url: "./users.php",
                    type: "POST",
                    dataType: 'json',
                    data: {action: "delete", username: loginValue},
                    success: function(returnedData) {
                        loadUsers();

                        //window.location.href = "user-editor.html";
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR.statusText, textStatus);
                    }
                });

            });

            $('#users').on('click', '.update', function() {
                var loginValue = this.getAttribute("id");
                //var firstName = $(this).val(
                loginValue = loginValue.replace("u-", "");
                var editedFirstName = $(this).parent().parent().find(".first_name span").text();
                var editedLastName = $(this).parent().parent().find(".last_name span").text();
                var editedUserName = $(this).parent().parent().find(".user_name span").text();
                var editedQuantity = $(this).parent().parent().find(".quantity span").text();
                //console.log(loginValue, editedFirstName);

                $.ajax({
                    url: "./users.php",
                    type: "POST",
                    dataType: 'json',
                    data: {action: "update", username: loginValue, newFirstName: editedFirstName, newLastName: editedLastName, newUserName: editedUserName, newQuantity: editedQuantity},
                    success: function(returnedData) {
                        loadUsers();

                        //window.location.href = "user-editor.html";
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR.statusText, textStatus);
                    }
                });

            });


            // http://stackoverflow.com/questions/11882693/change-table-cell-from-span-to-input-on-click
            $('#users').on('click', 'span', function() {

                var $td = $(this).parent();
                var $input = null;

                var val = $(this).html();

                if($td.attr('class') === 'first_name') {
                    //var val = $(this).html();
                    $td.html('<input type="text" value="' + val + '"/>');
                    var $input = $td.find('input');
                    $input.focus();
                    $input.select();
                }
                
                if($td.attr('class') === 'last_name') {
                    //var val = $(this).html();
                    $td.html('<input type="text" value="' + val + '"/>');
                    var $input = $td.find('input');
                    $input.focus();
                    $input.select();
                }
                
                 if($td.attr('class') === 'user_name') {
                    //var val = $(this).html();
                    $td.html('<input type="text" value="' + val + '"/>');
                    var $input = $td.find('input');
                    $input.focus();
                    $input.select();
                }
                
                if($td.attr('class') === 'quantity') {
                    //var val = $(this).html();
                    $td.html('<input type="text" value="' + val + '"/>');
                    var $input = $td.find('input');
                    $input.focus();
                    $input.select();
                }

                if($input != null) {

                    $input.on('blur', function() {
                        $(this).parent().html('<span>' + $(this).val() + '</span>');
                    });

                    $input.keyup(function(e) {
                        if(e.which == 13) {
                            $(this).parent().html('<span>' + $(this).val() + '</span>');
                        } else if(e.which == 27) {
                            // escape key, means user canceled operation
                            $(this).parent().html('<span>' + val + '</span>');
                        }
                    });
                }
            });



        });

    </script>
  <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
</html>
